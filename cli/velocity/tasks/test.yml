description: "Deploys application"
name: deploy
parameters: 
  - name: environment
    default: testing
    other_options:
      - production
  - name: AWS_ACCESS_KEY_ID
    secret: true
    
steps: 
  - 
    command: 
      - terraform
      - "--version"
    description: "Terraform Version"
    environment: 
      TFVAR_ENVIRONMENT: "${environment}"
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
    image: hashicorp/terraform
    type: run
  - 
    command: 
      - ls
      - "-al"
    description: "List directory"
    image: library/alpine
    type: run
    working_dir: ./tasks
  - 
    command: 
      - env
    description: "Show environment"
    environment: 
      WOO: "${environment}"
      ${environment}: AAAA
    image: library/alpine
    type: run
  - 
    command: 
      - pwd
    description: "Show pwd"
    image: library/alpine
    type: run
    mount_point: /app

  - type: plugin
    image: velocity/aws-push
    dind: true
    environment:
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      IMAGES: "vjftw/alpine:latest,vjftw/alpine:abc"
  
  - type: plugin
    image: velocity/docker-push
    dind: true
    environment:
      USERNAME: ${USERNAME}
      PASSWORD: ${PASSWORD}
      IMAGES: "vjftw/alpine:latest,vjftw/alpine:abc"